<app-modal-borrar-trivia></app-modal-borrar-trivia>
<div class="container" [@onLoadAnimation]>
  <div class="row d-flex justify-content-center">
        <!-- Titulo de la página -->
        <div class="misPartidas col-9 mt-5 ml-5">
          <h2 style="font-weight: bold">Editar Trivia</h2>
          <hr />
        </div>
  </div>
    <div class="row d-flex justify-content-center">
      <div class="col-8 mt-5 mb-5">
        <form [formGroup]="triviaForm" class="text-center">
          <div class="row d-flex justify-content-center mt-4">
            <div class="row d-flex justify-content-between  align-items-center">
              <!-- Boton para añadir una opcion a la pregunta -->
            <div class="col-sm-9 text-left my1 p-2">
              <h4 style="font-weight: bold">{{trivia?._nombre }}</h4>
             </div>
            <!-- Boton para eliminar pregunta -->
            <div class="col-sm-2 btn my-1 p-2"
            data-toggle="modal" data-target="#borrar-trivia-modal"
            style="background-color: #FF5C95; color: white;">
            <i class="bi bi-trash3"></i>
            </div>
            </div>
        </div>
          <div class="mt-2 mb-2">
            <!-- <div class="my-4 text-left">
              <h4 style="font-weight: bold">{{trivia?._nombre }}</h4>
            </div> -->
            <input type="text" class="form-control" formControlName="nombre" placeholder="Nombre: {{trivia?._nombre }}"/>
          </div>
          <div *ngIf="
          triviaForm.get('nombre')?.errors &&
          triviaForm.get('nombre')?.touched"
        class="alert alert-danger mt-1"
        role="alert">
        <small>Es requerido un nombre</small>
      </div>
          <div class="mt-2 mb-2">
            <input type="text" class="form-control" formControlName="descripcion" placeholder="Descripcion: {{trivia?._descripcion }}"/>
          </div>
          <div *ngIf="
          triviaForm.get('descripcion')?.errors &&
          triviaForm.get('descripcion')?.touched"
        class="alert alert-danger mt-1"
        role="alert">
        <small>Es requerida una descripcion</small>
      </div>
          <!-- Boton para añadir pregunta -->
          <button class="btn col-12 mt-3 p-2" (click)="agregarPregunta()"
          style="background-color:#FD999B; color: white;" >
          Agregar Pregunta
          </button>

          <div [hidden]="preguntas().controls.length == 0" formArrayName="preguntas">
            <div *ngFor="let pregunta of preguntas().controls; let indexPreg = index">
              <!-- <button class="btn col-md-5 mt-3 p-2" (click)="cambiarVisibilidad(pregunta)"
              style="background-color:#7161EF; color: white; font-size: 18px;" >
              Mostrar/Ocultar
              Pregunta N°{{ indexPreg + 1 }}
              </button> -->
              <div [formGroupName]="indexPreg" [hidden]="pregunta.value.visible">
                 <div class="mb-3 mt-3">
                  <h4 style="font-weight: bold;">Pregunta N°{{ indexPreg + 1 }}</h4>
                </div>
                <div class="mt-2 mb-2">
                  <input type="text" class="form-control" formControlName="leyenda" placeholder="Leyenda"/>
                </div>
                <div *ngIf="
                pregunta.get('leyenda')?.errors &&
                pregunta.get('leyenda')?.touched"
              class="alert alert-danger mt-1"
              role="alert">
              <small>Es requerida una leyenda</small>
            </div>
                <div class="mt-3 mb-2">
                  <select formControlName="tipoDePregunta" class="form-select">
                    <option  disabled value=""> Seleccione el tipo de pregunta</option>
                    <option *ngFor="let tipo of tipoDePregunta">{{ tipo }}</option>
                  </select>
                </div>
                <div *ngIf="
                pregunta.get('tipoDePregunta')?.errors &&
                pregunta.get('tipoDePregunta')?.touched"
              class="alert alert-danger mt-1"
              role="alert">
              <small>Debe seleccionar el tipo de pregunta</small>
            </div>

                <div class="row d-flex justify-content-center mt-4">
                  <div class="row d-flex justify-content-between  align-items-center">
                    <!-- Boton para añadir una opcion a la pregunta -->
                  <div class="col-sm-9 btn my1 p-2" (click)="agregarOpcion(indexPreg)"
                  style="background-color: #FD999B; color: white;">
                  Agregar Opción
                  </div>
                  <!-- Boton para eliminar pregunta -->
                  <div class="col-sm-2 btn my-1 p-2" (click)="eliminarPregunta(indexPreg)"
                  style="background-color: #FF5C95; color: white;">
                  <i class="bi bi-trash3"></i>
                  </div>
                  </div>
              </div>

                <!-- <div class="text-center mt-2 mb-2">
                  <h5 *ngIf="opciones(indexPreg).controls.length == 0"><strong>No hay opciones</strong></h5>
                </div> -->

                <!-- Form para opciones de las preguntas del quiz-->
                <div formArrayName="opciones">
                  <div *ngFor="
                  let opcion of opciones(indexPreg).controls;
                  let indexOpc = index">
                  <div class="mb-3 mt-5">
                    <h4 style="font-weight: bold;">Opción N°{{ indexOpc + 1 }}</h4>
                  </div>

                  <div class="row d-flex justify-content-center mt-4">
                      <div [formGroupName]="indexOpc" class="col-12">
                        <div class="mt-2 mb-2 ">
                          <input type="text" class="form-control" formControlName="descripcion" placeholder="Descripcion"/>
                        </div>
                        <div *ngIf="
                        opcion.get('descripcion')?.errors &&
                        opcion.get('descripcion')?.touched"
                      class="alert alert-danger mt-1"
                      role="alert">
                      <small>Es requerida una descripcion</small>
                    </div>
                         <div class="mt-3 mb-2 ">
                          <select formControlName="esCorrecta" class="form-select">
                            <option disabled selected> Seleccione si es correcta o no</option>
                            <option [ngValue]="true">Correcta</option>
                            <option [ngValue]="false">Incorrecta</option>
                          </select>
                        </div>
                        <div *ngIf="
                        opcion.get('esCorrecta')?.errors &&
                        opcion.get('esCorrecta')?.touched"
                      class="alert alert-danger mt-1"
                      role="alert">
                      <small>Debe seleccionar si es correcta</small>
                    </div>
                      </div>
                      <div class="row d-flex justify-content-end">
                        <!-- Boton para eliminar opcion -->
                      <div class="col-sm-2 btn my-1 p-2" (click)="eliminarOpcion(indexPreg, indexOpc)"
                      style="background-color: #FF5C95; color: white;">
                      <i class="bi bi-trash3"></i>
                      </div>
                      </div>
                    </div>


                  </div>
                </div>
              </div>
              <!-- <div class="mt-3 mb-2" style="background-color: rgba(253, 153, 155, 1); height: 2px;"></div> -->

            </div>
          </div>

          <!-- Boton para crear trivia-->
          <button class="btn col-6 mt-5 mb-4 p-2" (click)="editarTrivia()" [disabled]="triviaForm.invalid"
          style="background-color: #7161EF;color: white;"
          >
            Editar y Guardar Trivia
          </button>
        </form>

        <!-- VISUALIZACION DE TODOS LOS DATOS-->
        <pre>{{ triviaForm.value | json }}</pre>
      </div>
    </div>
  </div>







